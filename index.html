<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>写真撮影アプリ</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #000;
            min-height: 100vh;
            color: white;
        }
        
        h1 {
            color: #fff;
            margin: 15px 0;
            font-size: 24px;
        }
        
        .container {
            position: relative;
            margin: 0 auto;
            text-align: center;
            width: 100%;
            max-width: 100vw;
            height: auto;
            overflow: hidden;
        }
        
        #video {
            width: 100%;
            max-width: 100vw;
            height: auto;
            object-fit: cover;
            display: block;
        }
        
        #canvas {
            display: none;
            width: 100%;
            height: auto;
        }
        
        #photo {
            width: 100%;
            max-width: 100vw;
            height: auto;
            display: none;
        }
        
        .buttons {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            z-index: 10;
        }
        
        #takePhoto {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8);
            border: 4px solid white;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        #takePhoto::after {
            content: "";
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: white;
            border: 2px solid rgba(255, 255, 255, 0.8);
        }
        
        #switchCamera, #retake {
            width: 50px;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .frame-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5;
        }
        
        #custom-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: none;
        }
        
        .frame-selector {
            margin: 10px 0;
            display: flex;
            gap: 10px;
            flex-wrap: nowrap;
            justify-content: center;
            overflow-x: auto;
            padding: 5px 0;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        .frame-option {
            min-width: 60px;
            height: 45px;
            border: 2px solid #555;
            cursor: pointer;
            transition: border-color 0.3s;
            box-sizing: border-box;
            border-radius: 4px;
            overflow: hidden;
            flex-shrink: 0;
            position: relative;
            background-color: #333;
        }
        
        .frame-option img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .frame-option:hover, .frame-option.active {
            border-color: #4285f4;
        }
        
        .frame-option.none {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .frame-option.none::after {
            content: "×";
            font-size: 20px;
            color: #f44336;
        }
        
        .save-info {
            position: fixed;
            bottom: 100px;
            left: 0;
            right: 0;
            text-align: center;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            font-size: 14px;
            display: none;
        }
        
        #flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.1s;
        }
    </style>
</head>
<body>
    <h1>写真撮影アプリ</h1>
    
    <div class="frame-selector">
        <div class="frame-option none active" data-frame="none"></div>
        <div class="frame-option" data-frame="custom">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAANnSURBVHhe7ZvNThNRFMf/58xMO1CgFCGiQNRoojHRjS5d+RDufBJXPoJv4BN07calsHDhQoKJiZFoCBhC+KAFWmY6c4/3TprU0GFa0o/Tmd8vIHPa3raT/zm359bkAojAGGsAWAcQaK1lE6FQStlarcaGYZzi2bM36sGjR8GrV2/c/b099+D1a+/g4ED2ej3PNE1SChyGwZCyGIdStSdKTR39Hs1FoGEYZ7PZrHL06LHZiYnJST4xkcsZVjorx8bnxnPF8txsIX/EMizHGRt3bcdxHafgOE7BdWzj7NmTnPHx/EK5XD5Xr9eNs/U6+/jRwadPbfReebi11UCn08FenwEWB8cYpNaAjWGZDF5vAA4D8hzQwggbdcGqHMEqQKqEuATHPqPU0lJUhTQn0FJ6vZbXPWlMTRUzk5Pj+Xx+LJvNcmvMsKXleI7tBgW7IKanzxkz5TJ/f+FCafHC+fVGo+G32w209/fRuH0bXwGcBIZlbgq1nN6/uMzJdJQm8AAYD0aQUmrD9zGfyeCCbbNKscj2mhrxRVUwHXh6OdBRoNEXyJ1OxjZMSCnheZ5wXdf0/Z7p94LM4eGhXa/X7a3NDXu9WrXX19ft2QzTGZ/vw/N6aIVhuAegFYZhu9vttkK/J3rdnhjL5ZyZ0rxp2Jni0tIS5uxc6H/r+u23rrfTEd/Cg0L4qScUU5BSClrrcRzOzc1ZhUIh8H3f3N7aNquVilWpVMdardZ4p9PBwqVL2IhHXcYRXHsYRq//0+u/b/S32w1jGMiZDH6pnx/NrRJpFZ5FXwGe55lhGCrf98nzPPT7fUHvGfq+vF+5jFvxKB1o9QxLvXr8GDuMYTqTwd1Y4kAyE8g4RyaXwz0ALSXRiUSjlMLu7i5evnyJrFJ4BGAnHvUbw5YoCcOUQlVr3AzD8Eu8TEQiEpvNJnZ2drC8vIzV1VWsra1B7e/jJoBXAFbj8G/FdVW1FD638GcTmjS2trZQq9UunZycoNVq4c2bFr5/O0b76Ajt9nfsPXuGhwCuxeH/Ih6lXy4mLfFrlP1JTGAURbh69Sp2d3cghNA7Ozu6WCzq+fl5fWN/X396/17v7+/r+Iqj1Gq1EiEviWwcBpLI6Qs7CoocTvSdyJGIQAIJEUggIYJAAgkRBBJIiCCQQEIEgQQSIggkkBBBIIGECAIJJEQQSCAhgkACCREEEkiIIJBAQgSBBBIiCCSQEEEggYQIAgkkRBD4iwM/AOxAn31V7UdFAAAAAElFTkSuQmCC" alt="カスタムフレーム">
        </div>
    </div>
    
    <div class="container">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
        <img id="photo" alt="撮影した写真">
        <div class="frame-container">
            <img id="custom-frame" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAANnSURBVHhe7ZvNThNRFMf/58xMO1CgFCGiQNRoojHRjS5d+RDufBJXPoJv4BN07calsHDhQoKJiZFoCBhC+KAFWmY6c4/3TprU0GFa0o/Tmd8vIHPa3raT/zm359bkAojAGGsAWAcQaK1lE6FQStlarcaGYZzi2bM36sGjR8GrV2/c/b099+D1a+/g4ED2ej3PNE1SChyGwZCyGIdStSdKTR39Hs1FoGEYZ7PZrHL06LHZiYnJST4xkcsZVjorx8bnxnPF8txsIX/EMizHGRt3bcdxHafgOE7BdWzj7NmTnPHx/EK5XD5Xr9eNs/U6+/jRwadPbfReebi11UCn08FenwEWB8cYpNaAjWGZDF5vAA4D8hzQwggbdcGqHMEqQKqEuATHPqPU0lJUhTQn0FJ6vZbXPWlMTRUzk5Pj+Xx+LJvNcmvMsKXleI7tBgW7IKanzxkz5TJ/f+FCafHC+fVGo+G32w209/fRuH0bXwGcBIZlbgq1nN6/uMzJdJQm8AAYD0aQUmrD9zGfyeCCbbNKscj2mhrxRVUwHXh6OdBRoNEXyJ1OxjZMSCnheZ5wXdc0/Z7p94LM4eGhXa/X7a3NDXu9WrXX19ft2QzTGZ/vw/N6aIVhuAegFYZhu9vttkK/J3rdnhjL5ZyZ0rxp2Jni0tIS5uxc6H/r+u23rrfTEd/Cg0L4qScUU5BSClrrcRzOzc1ZhUIh8H3f3N7aNquVilWpVMdardZ4p9PBwqVL2IhHXcYRXHsYRq//0+u/b/S32w1jGMiZDH6pnx/NrRJpFZ5FXwGe55lhGCrf98nzPPT7fUHvGfq+vF+5jFvxKB1o9QxLvXr8GDuMYTqTwZ1Y4kAyE8g4RyaXwz0ALSXRiUSjlMLu7i5evnyJrFJ4BGAnHvUbw5YoCcOUQlVr3AzD8Eu8TEQiEpvNJnZ2drC8vIzV1VWsra1B7e/jJoBXAFbj8G/FdVW1FD638GcTmjS2trZQq9UunZycoNVq4c2bFr5/O0b76Ajt9nfsPXuGhwCuxeH/Ih6lXy4mLfFrlP1JTGAURbh69Sp2d3chhNA7Ozu6WCzq+fl5fWN/X396/17v7+/r+Iqj1Gq1EiEviWwcBpLI6Qs7CoocTvSdyJGIQAIJEUggIYJAAgkRBBJIiCCQQEIEgQQSIggkkBBBIIGECAIJJEQQSCAhgkACCREEEkiIIJBAQgSBBBIiCCSQEEEggYQIAgkkRBD4iwM/AOxAn31V7UdFAAAAAElFTkSuQmCC" alt="カスタムフレーム">
        </div>
    </div>
    
    <div class="buttons">
        <button id="switchCamera">↺</button>
        <button id="takePhoto"></button>
        <button id="retake">←</button>
    </div>
    
    <div class="save-info" id="saveInfo">
        画像を長押しして保存できます
    </div>
    
    <div id="flash-overlay"></div>
    
    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const photo = document.getElementById('photo');
        const takePhotoButton = document.getElementById('takePhoto');
        const retakeButton = document.getElementById('retake');
        const switchCameraButton = document.getElementById('switchCamera');
        const saveInfo = document.getElementById('saveInfo');
        const flashOverlay = document.getElementById('flash-overlay');
        const customFrame = document.getElementById('custom-frame');
        const frameOptions = document.querySelectorAll('.frame-option');
        
        let stream = null;
        let facingMode = "user"; // 初期値はフロントカメラ（自撮り）
        
        // キャンバスのサイズをビデオに合わせる
        function resizeCanvas() {
            const videoWidth = video.videoWidth;
            const videoHeight = video.videoHeight;
            if (videoWidth && videoHeight) {
                canvas.width = videoWidth;
                canvas.height = videoHeight;
            }
        }
        
        // カメラへのアクセス
        async function startCamera() {
            try {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
                
                const constraints = {
                    video: {
                        facingMode: facingMode,
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    },
                    audio: false
                };
                
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                
                // ビデオのメタデータがロードされたらキャンバスのサイズを調整
                video.onloadedmetadata = () => {
                    resizeCanvas();
                };
                
                takePhotoButton.disabled = false;
                switchCameraButton.disabled = false;
                retakeButton.disabled = true;
                
                // 初期状態で写真とセーブ情報は非表示
                photo.style.display = 'none';
                saveInfo.style.display = 'none';
                video.style.display = 'block';
            } catch (err) {
                console.error("カメラへのアクセスに失敗しました:", err);
                alert("カメラへのアクセスに失敗しました。カメラの使用許可を確認してください。");
            }
        }
        
        // フラッシュエフェクト
        function flashEffect() {
            flashOverlay.style.opacity = '1';
            setTimeout(() => {
                flashOverlay.style.opacity = '0';
            }, 100);
        }
        
        // カメラ起動
        startCamera();
        
        // カメラの切替（フロント/バック）
        switchCameraButton.addEventListener('click', () => {
            facingMode = facingMode === "user" ? "environment" : "user";
